{% extends "admin/core/base.html" %}
{% load foundation %}
{% load model %}
{% load static from staticfiles %}
{% load svg from press_url %}
{% load i18n %}

{% block title %}Journal Home Page Manager{% endblock title %}
{% block title-section %}Journal Home Page Manager{% endblock %}
{% block title-sub %}Settings{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li><a href="{% url 'core_manager_index' %}">Manager</a></li>
    <li>Journal Home Page Settings</li>
{% endblock %}

{% block body %}
    <div class="row expanded" data-equalizer>
    <form method="POST">
        {% csrf_token %}
        <div class="large-12 columns">
            <div class="box">
            <div class="title-area">
                    <h2>Page Layout</h2>
                </div>
                <div class="content" style="border: 1px solid black">
                    <header class="main-header title-area">
                        <div class="top-bar-left header-image-bar" style=></div>
                                <i><img src="{% static "common/img/sample/janeway.png" %}"></i>
                        <div class="top-bar-right header-image-bar"></div>
                    </header>
                    {% csrf_token %}
                    <div class="list-group" id="active" style="display:inline-block;padding:2%;width: 100%">
                      {% for row in structure %}
                        {% for item in row %}
                        <li class="list-group-item medium-{{item.columns}} columns" id="element-{{ item.pk }}">
                                <div class="float-right">
                                    <button type="submit" name="edit" value="{{ item.id }}" class="tiny success button"><i
                                            class="fa fa-edit"></i></button>
                                    <button type="submit" name="delete" value="{{ item.id }}" class="tiny alert button"><i
                                            class="fa fa-trash"></i></button>
                                </div>
                                <small><i class="fa fa-sort">&nbsp;</i>{{ item|verbose_name }}</small>
                            </li>
                        {% endfor %}
                      {% endfor %}
                    </div>
                    <div class="main-footer">
                        <div class="row expanded" data-equalizer data-equalize-on="medium">
                            <div class="large-2 columns very-dark-primary-color text-center" data-equalizer-watch>
                                {% if request.journal.press_image_override %}
                                    {% svg request.journal_cover %}
                                {% elif 'svg' in request.press_cover %}
                                <i>{% svg request.press_cover %}</i>
                                {% else %}
                                <i>{% svg "static/common/img/sample/janeway.svg" %}</i>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    </div>
    <div>
        {% for block_model, block_form in forms %}
        <form method="post" name="{{ block_model|class_name }}">
            {% csrf_token %}
            <h3> {{ block_model|verbose_name}} Options </h3>
            {{ block_form.media.css }}
            {{ block_form }}
            <input type="hidden" name="block" value="{{ block_model|class_name }}">
            <button type="submit" class="success button">Save</button>
        </form>
        {% endfor %}
    </div>
{% endblock body %}

{% block js %}
    {% include "elements/datatables.html" with target="#featured" %}
    <script src="{% static "admin/js/csrf.js" %}"></script>
    <script type="text/javascript" src="{% static "common/js/jq-ui.min.js" %}"></script>
    <script>
        $("#active").sortable({
            update: function (event, ui) {
                var data = $(this).sortable('serialize');
                console.log(data);
                // POST to server using $.post or $.ajax
                $.ajax({
                    data: data,
                    type: 'POST',
                    url: '{% url 'journal_home_order' %}'
                });
            }
        });
        $("#active").disableSelection();
    </script>
    {% include "elements/jqte.html" %}
    {% for _, form in forms %}
      {{ form.media.js }}
    {% endfor %}
{% endblock js %}


